- [Hướng dẫn cài đặt Netbox 3.7.8](#hướng-dẫn-cài-đặt-netbox-378)
  - [1. Yêu cầu cần thiết](#1-yêu-cầu-cần-thiết)
  - [2. Các bước cài đặt](#2-các-bước-cài-đặt)
    - [2.1 Cài đặt PostgreSQL](#21-cài-đặt-postgresql)
    - [2.2 Cài đặt Redis](#22-cài-đặt-redis)
    - [2.3 Cài đặt Python và các gói phụ trợ , git và nginx](#23-cài-đặt-python-và-các-gói-phụ-trợ--git-và-nginx)
    - [2.4 Cài đặt Netbox](#24-cài-đặt-netbox)
- [Tài liệu tham khảo](#tài-liệu-tham-khảo)
# Hướng dẫn cài đặt Netbox 3.7.8
## 1. Yêu cầu cần thiết
Để có thể cài đặt Netbox 3.7.8 thì cân các yếu tố sau:
- PostgreSQL : Dùng để làm cơ sở dữ liệu cho Netbox sử dụng
- Redis : NetBox sử dụng Redis để làm Caching ( lưu trữ các kết quả truy vấn cơ sở dữ liệu thường xuyên được yêu cầu), Session Storage (Redis có thể được sử dụng để lưu trữ thông tin session của người dùng.), Task Queue (hàng đợi tác vụ)
- git: Dùng để tải xuống Netbox
- nginx : Dùng để truy cập vào web của Netbox
- Python và các thư viện của nó : gcc python36 python36-devel python36-setuptools libxml2-devel libxslt-devel libffi-devel openssl-devel redhat-rpm-config
easy_install-3.6 pip
## 2. Các bước cài đặt
### 2.1 Cài đặt PostgreSQL
- Cài đặt SQL
    ```
    apt update -y
    apt install postgresql postgresql-contrib -y
    ```
- Kiểm tra xem postgresql đã thực hiện chưa
  ```
  systemctl status postgresql
  ```
  ![](../anh/Screenshot_40.png)

- Đăng nhập và postgresql
  ```
  sudo -i -u postgres psql
  ```
- Tạo user và passwd để sử dụng postgresql
  ```
  CREATE USER netbox WITH PASSWORD 'password';
  ```
- Tạo database cho Netbox sử dụng
  ```
  CREATE DATABASE netbox;
  ```
- Gắn quyền sử dụng database mới tạo cho người dùng
  ```
  ALTER DATABASE netbox OWNER TO netbox;
  ```
- Thoát
  ```
  \q
  ```
### 2.2 Cài đặt Redis
- Cài đặt redis
  ```
  apt install redis -y
  ```
- Bạn có thể kiểm tra mình đã cài đặt Redis bằng lệnh
  ```
  root@Quang-Netbox:# redis-server -v
  Redis server v=6.0.16 sha=00000000:0 malloc=jemalloc-5.2.1 bits=64 build=a3fdef44459b3ad6
  ```
- Sử dụng redis-cli để đảm bảo dịch vụ redis hoạt động
  ```
  root@Quang-Netbox:~# redis-cli ping
  PONG
  ```
### 2.3 Cài đặt Python và các gói phụ trợ , git và nginx
- Cài đặt git
  ```
  apt install git -y
  ```
- Cài đặt Python và các gói phụ trợ
  ```
  apt install -y python3 python3-pip python3-venv python3-dev build-essential libxml2-dev libxslt1-dev libffi-dev libpq-dev libssl-dev zlib1g-dev
  ```
- Cài đặt Nginx
  ```
  apt install -y nginx
  ```
### 2.4 Cài đặt Netbox
- Tạo thư mục chứa các file tải xuống của Netbox
  ```
  mkdir -p /opt/netbox/
  ```
- Di chuyển đến thư mục vừa tạo và tải netbox từ git xuống
  ```
  cd /opt/netbox
  git clone -b v3.7.8 https://github.com/netbox-community/netbox.git
  git config --global --add safe.directory /opt/netbox
  ```
- Tạo user Netbox và chuyển chủ sở hữu cho thư mục netbox
  ```
  adduser --system --group netbox
  chown --recursive netbox /opt/netbox
  ```
- Thiết lập môi trường python. Tạo một môi trường python ảo để chắc chắn các thư viện dùng cho NetBoxkhông bị xung đột với các ứng dụng khác. Ở đây sẽ tạo ra một thư mục venv bên trong thư mục root của NetBox
  ```
  python3 -m venv /opt/netbox/venv
  ```
- Tạo file configuaration.py
  ```
  cd /opt/netbox/netbox/netbox/netbox/
  cp configuration.example.py configuration.py
  ```
- Tạo a secret key
  ```
  python3 ../generate_secret_key.py
  ```
  ```
  Sor-X^(KL5o5%dj8cJD_C4K9y-M3mSQgpZV^mgVTEA&ht+3QWU
  ```
- Sửa file cấu hình 
  ```
  vi configuration.py
  ```
  - Khai báo địa chỉ IP hoặc domain mà bạn có thể truy cập vào NetBox
  ```
  ALLOWED_HOSTS = ['172.16.66.54']
  ```
  - Khai báo thông tin database
  ```
  DATABASE = {
      'NAME': 'netbox',               # Database name
      'USER': 'netbox',               # PostgreSQL username
      'PASSWORD': 'your_password', # PostgreSQL password
      'HOST': 'localhost',            # Database server
      'PORT': '',                     # Database port (leave blank for default)
      'CONN_MAX_AGE': 300,            # Max database connection age
  }
  ```
  - Nếu bạn ko thay đổi cấu hình redis thì giữ nguyên ko cần khai báo bên dưới
  ```
    REDIS = {
        'tasks': {
            'HOST': 'localhost',
            'PORT': 6379,
            # Comment out `HOST` and `PORT` lines and uncomment the following if using Redis Sentinel
            # 'SENTINELS': [('mysentinel.redis.example.com', 6379)],
            # 'SENTINEL_SERVICE': 'netbox',
            'PASSWORD': '',
            'DATABASE': 0,
            'DEFAULT_TIMEOUT': 300,
            'SSL': False,
        },
        'caching': {
            'HOST': 'localhost',
            'PORT': 6379,
            # Comment out `HOST` and `PORT` lines and uncomment the following if using Redis Sentinel
            # 'SENTINELS': [('mysentinel.redis.example.com', 6379)],
            # 'SENTINEL_SERVICE': 'netbox',
            'PASSWORD': '',
            'DATABASE': 1,
            'DEFAULT_TIMEOUT': 300,
            'SSL': False,
        }
    }
  ```
- Cài đặt Netbox
  ```
  /opt/netbox/netbox/upgrade.sh
  ```
- Tạo Netbox User Admin
  ```
  source /opt/netbox/venv/bin/activate
  cd /opt/netbox/netbox
  python3 manage.py createsuperuser
  ```
  - Ta đặt user theo mẫu bên dưới
  ```
  Username (leave blank to use 'root'): nadmin
  Email address: admin@example.com
  Password: 
  Password (again): 
  Superuser created successfully.
  ```
- Tạo symbolic link to the NetBox service file.

# Tài liệu tham khảo
https://www.atlantic.net/dedicated-server-hosting/how-to-install-netbox-irm-on-ubuntu-22-04/

https://news.cloud365.vn/netbox-phan-1-huong-dan-cai-dat-netbox-tren-centos-7/
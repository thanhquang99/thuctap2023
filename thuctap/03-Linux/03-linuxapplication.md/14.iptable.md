# Tìm hiểu về iptable trong linux
## 1. Tại sao lại phải sử dụng iptable
- Iptables là một chương trình tường lửa dành cho Linux. 
- Nó sẽ giám sát lưu lượng truy cập từ và đến máy chủ của bạn bằng cách sử dụng bảng. 
- Các bảng này chứa các bộ quy tắc, được gọi là chuỗi, sẽ lọc các gói dữ liệu đến và đi.
## 2. Các khái niệm cần nắm rõ để sử dụng ip table
- Trong iptable sẽ có 3 khái niệm chính là table ,chain (chuỗi), rule (quy tắc)
  - Mỗi bảng định nghĩa một không gian tên để lưu trữ các quy tắc tường lửa
  - Mỗi bảng chứa một hoặc nhiều chuỗi, là các nhóm quy tắc tường lửa được tổ chức theo các loại khác nhau.
  - Các chuỗi quy định các điều kiện và hành động được áp dụng cho các gói tin.
  - Mỗi chuỗi chứa một loạt các quy tắc, mỗi quy tắc xác định cách mà gói tin cụ thể sẽ được xử lý.

## 3. Các bảng trong iptable
- Đầu tiên ta cần phải hiểu rằng iptable được chia làm 3 bảng:
  - Bảng mangle : bảng này để thay đổi QoS của gói tin như thay đôi các tham số TOS,TTL,..
  - Bảng NAT : dùng để thay đổi đích, nguồn, port của các gói tin
  - Bảng filter : Đây là bảng dùng để áp dụng các chính sách lọc gói tin , có cho phép các gói tin đi qua hay không

`Bình thường bảng nat và filter rất hay được sử dụng`
### 3.1 Bảng NAT
- Trong bảng NAT có các chain và có 4 chain được xây dựng sẵn trong table NAT:
  - `Chain PREROUTING` : 
    - Chuỗi này áp dụng các quy tắc trước khi gói tin được định tuyến.
    - Thường được sử dụng để thực hiện các biến đổi địa chỉ đích của gói tin trước khi nó đến đích.
    - 
    ```
    iptables -t nat -A PREROUTING ...
    ```
  - `POSTROUTING`: 
    - Chuỗi này áp dụng các quy tắc sau khi gói tin đã được định tuyến.
    - Thường được sử dụng để thực hiện các biến đổi địa chỉ nguồn của gói tin trước khi nó rời khỏi hệ thống.
    ```
    iptables -t nat -A POSTROUTING ...
    ```
  - `OUTPUT` : 
    - Chuỗi này áp dụng các quy tắc cho gói tin được tạo ra bởi chính hệ thống
    - Thường được sử dụng để thực hiện NAT cho gói tin được tạo ra từ localhost trước khi chúng rời đi.
    ```
    iptables -t nat -A OUTPUT ...
    ```
  - `INPUT`
    - Chuỗi này áp dụng các quy tắc cho gói tin đến địa chỉ IP đích là hệ thống
    - Thường được sử dụng để thực hiện NAT cho gói tin trước khi chúng đến máy chủ
    ```
    iptables -t nat -A INPUT ...
    ```
### 3.2 Bảng filter
- Các chain có sẵn trong bảng filter
  - `INPUT`: 
    - đây là chain dùng để lọc các gói tin đầu vào
    - Chain này là chain các gói tin bắt buộc phải đi qua để có thể được xử lý
  - `OUTPUT`
    - đây là chain dùng để lọc các gói tin đâu ra
    - Chain này là chain sau khi gói tin được xử lý phải đi qua chain này để ra được bên ngoài.
  - `FORWARD`
    - đây là chain dùng để chuyển gói tin qua lại giữa các card mạng với nhau.
- Các target được sử dụng trong các chain này có thể là ACCEPT (đồng ý) , DROP (xóa bỏ)
### 3.3 Bảng Mangle
- Trong bảng mangle bao gồm tất cả các chain được xây dựng sẵn là: PREROUTING, POSTROUTING, INPUT, OUTPUT, FORWARD
## 4. Quá trình xử lý gói tin trong iptable
- Đầu tiên gói tin phải đi qua bảng Mangle với chain là PREROUTING (với mục đích để thay đôi một số thông tin của gói tin trước khi đưa qua quyết định dẫn đường)
- Tiếp đó gói tin đến bảng NAT với với chain PREROUTING tại đây địa chỉ đích của gói tin có thể bị thay đổi hoặc không, qua bộ routing và sẽ quyết định xem gói tin đó thuộc firewall hay không
- Lúc này sẽ có 2 trường hợp là gói tin đó có thuộc firewall hay không
  - 

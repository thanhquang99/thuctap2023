# Download nginx từ source code
- Mặc định nginx có 2 cách download đó là download từ các packet bằng yum và download tử source 
- Download từ Source ta có thể lựa chọn ra các tính năng cần và không cần .Thêm 1 điều nữa là download từ source sẽ cho phép chúng ta thêm các module hỗ trợ từ bên thứ 3
- Để download được nginx từ source thì cần có 4 yếu tố hỗ trợ 
  - pcre
  - zlib
  - openssl
  - Một số yếu tố khác khi ta cài lên thiếu sẽ thông báo
  ```
  yum install zlib-devel pcre-devel openssl-devel -y
  ```
  ```
  yum install perl perl-devel perl-ExtUtils-Embed libxslt libxslt-devel libxml2 libxml2-devel gd gd-devel GeoIP GeoIP-devel -y
  ```
# Hướng dẫn cài đặt nginx từ source
- Cập nhật hệ thống:
  ```
  yum check-update || yum update -y
  ```
- Cài đặt Development libreries
  ```
  yum groupinstall " Development Tools"  -y
  ```
- Cài đặt các gói hỗ trợ trong quá trình biên dịch
  ```
  yum install zlib-devel pcre-devel openssl-devel -y
  ```
- Cài đặt kho Epel repository cho hệ thống:
  ```
  yum install epel-release -y
  ```
- Cài các yêu cầu tùy chọn để Nginx có thể chạy trên hệ thống
  ```
    sudo yum install perl perl-devel perl-ExtUtils-Embed libxslt libxslt-devel libxml2 libxml2-devel gd gd-devel libmaxminddb libmaxminddb-devel -y
  ```
- Tải Nginx và giải nén
  ```
  cd /usr/src
  wget https://nginx.org/download/nginx-1.18.0.tar.gz
  tar -xvf nginx-1.18.0.tar.gz
  ```
- Tải xuống module nginx-vts
  ```
  yum install git -y
  git clone https://github.com/vozlt/nginx-module-vts.git
  ```
- Di chuyển vào file nginx và tiến hành cài đặt
  ```
  cd nginx-1.18.0
  ```
- Tiếp theo ta chạy file configure để chỉnh sửa cấu hình của nginx
  ```
  yum groupinstall "Development Tools" -y
  ```
  ```
    ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --error-log-path=/var/log/nginx/error.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --user=nginx --group=nginx --with-compat --add-dynamic-module=/usr/src/nginx-module-vts
  ```
- Tiến hành cấu hình
  ```
  make
  ```
- Tiến hành chạy cài đặt các cấu hình
  ```
  make install
  ```
- Kiểm tra xem nginx đã cài đặt thành công hay chưa
  ```
  nginx -v
  ```
  ```
  [root@localhost nginx-1.18.0]# nginx -v
  nginx version: nginx/1.18.0
  [root@localhost nginx-1.18.0]#
  ```
- Tạo user nginx và không cho phép đăng nhập
  ```
  adduser --system --no-create-home --shell /sbin/nologin nginx
  ```
- Chỉnh sửa cho phép user nginx thao tác với dịch vụ nginx
  ```
  vi /etc/nginx/conf/nginx.conf
  ```
- Chỉnh sửa
  ```
  #user  nobody; => user nginx
  ```
- Để có coi nginx như là một dịch vụ ta cần chỉnh sửa file `/usr/lib/systemd/system`
  ```
  vi /usr/lib/systemd/system/nginx.service
  ```
- Thêm nội dung sau vào tệp:
    ```
    [Unit]
    Description=nginx - high performance web server
    Documentation=https://nginx.org/en/docs/
    After=network-online.target remote-fs.target nss-lookup.target
    Wants=network-online.target

    [Service]
    Type=forking
    PIDFile=/var/run/nginx.pid
    ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/conf/nginx.conf
    ExecStart=/usr/sbin/nginx -c /etc/nginx/conf/nginx.conf
    ExecReload=/bin/kill -s HUP $MAINPID
    ExecStop=/bin/kill -s TERM $MAINPID

    [Install]
    WantedBy=multi-user.target
    ```
- Start và Enable Dịch vụ Nginx bằng cách chạy lệnh sau:
  ```
  systemctl daemon-reload
  systemctl start nginx
  systemctl enable nginx
  ```


# Tìm hiểu về Nginx Virtual Host Traffic Status
- Nginx Virtual Host Traffic Status là một module cho phép chúng ta theo dõi thống kê tình trạng lưu lượng của truy cập virtual host
- Để có thể cài đặt được module này ta cần có sẵn nginx sau đó mới tiến hành tải module đó về sau đó áp nó vào để sử dụng
- Các phiên bản nginx tương thích bạn có thể tham khảo [ở đây](https://github.com/vozlt/nginx-module-vts?tab=readme-ov-file#compatibility)

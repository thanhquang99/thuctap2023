# Hướng dẫn chuyển log vCenter về Log Server
Vcenter giống như Linux sử dụng rsyslog để quản lý log của mình

![Alt](/thuctap/anh/Screenshot_1003.png)

![Alt](/thuctap/anh/Screenshot_1004.png)



## 1. Tiến hành đẩy toàn bộ log của vCenter sang Log Server
### 1.1 Cấu hình trên Log server
- Chỉnh sửa file cấu hình
  ```
  vi /etc/rsyslog.conf
  ```
- Thêm vào nội dung sau:
  ```
  $template RemoteServer, "/var/log/vcenter-log/%fromhost-ip%/%programname%"
  if $fromhost-ip startswith '172.16.66.46' then ?RemoteServer
  & ~
  ```
  ![Alt](/thuctap/anh/Screenshot_1005.png)

  Do trên đã khai báo module `imudp` rồi nên ta không cần khai báo thêm tiếp. Nếu chưa khai báo cần thêm vào 2 dòng này

  ```
  $ModLoad imudp
  $UDPServerRun 514
  ```

- Tiến hành restart lại rsyslog
  ```
  systemctl restart rsyslog
  systemctl status rsyslog
  ```
  ![Alt](/thuctap/anh/Screenshot_1006.png)

- Ta cần bật firewall cho ứng dụng rsyslog. Ở bài trước đã bật rồi. Các bạn có thể tham khảo
  ```
  ufw allow 514/udp
  ufw reload
  ```

### 1.2 Cấu hình trên vCenter
- Chỉnh sửa lại file cấu hình rsyslog của vCenter
  ```
  vi /ets/rsyslog.conf
  ```
  Thêm nội dung sau vào cuối file
  
  ```
  *.* @172.16.66.50:514
  ```
- Tiến hành mở firewall và restart lại dịch vụ rsyslog
  ```
  
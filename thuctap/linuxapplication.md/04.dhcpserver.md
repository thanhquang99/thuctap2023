# DHCP
## Mô hình lab
![Alt](/thuctap/anh/Screenshot_622.png)
- Phân tích:
  - Mô hình này gồm 2 máy khác nhau , centos8 đóng vai trò làm dhcp-server và centos7 đóng vai trò làm dhcp-client
  - máy centos 8 cần có 2 card mạng và centos 7 chỉ cần 1 card mạng
  - gắn 1 card mạng của centos 8 và centos 7 vào dải VM-net 2(host-only) và tắt dhcp của VM-net2
  - Gắn 1 card mạng của centos 8 vào dải VM-net8 (NAT) 
- Yêu cầu
  - Máy centos 8 có thể tự động cấp IP mà trong dải chỉ định cho centos 7
  - Máy centos7 có thể thông quan centos8 mà ping ra môi trường internet
## Thực hành 
### Thêm card mạng và đặt IP mới cho centos 8
- Ta tiến hành gắn thêm 1 card mạng và thêm nó vào dải VM-net2
  ![Alt](/thuctap/anh/Screenshot_623.png)
- 1 card mạng đã được gắn sẵn vào VM-net8(NAT) và được đặt sẵn IP và `192.168.10.25/24`
- Tiến hành đặt IP cho card mạng thứ 2 là `192.168.20.3/24`
    ```
    vi /etc/sysconfig/network-scripts/ifcfg-ens224
    ```
  - Thêm những dòng bên dưới đây vào file
    ```
    TYPE=Ethernet
    DEVICE=ens224
    ONBOOT=yes
    NAME=ens224
    BOOTPROTO=static
    IPADDR=192.168.20.3
    PREFIX=24
    ```
- Lưu và tiến hành restart lại NetworkManager
  ```
  systemctl restart NetworkManager
  ```
- Kiểm tra lại các card mạng đã nhận ip chưa
  ![Alt](/thuctap/anh/Screenshot_624.png)

### Cài đặt DHCP server cho centos 8
- Ta tiến hành tải các gói `dhcp-server` về máy
  ```
  yum install -y dhcp-server*
  ```
- Tiến hành sửa file cấu hình
  ```
  vi /etc/dhcp/dhcpd.conf
  ```
- Ta thêm nội dung sau vào cuối file
  ```
  subnet 192.168.20.0 netmask 255.255.255.0 {
        range 192.168.20.10 192.168.20.40;
        option domain-name-servers 8.8.8.8;
        option broadcast-address 192.168.20.255;
        default-lease-time 3600;
        max-lease-time 7200;
    }
  ```
  - Giải thích
    - Dòng 1 : khai báo dải mạng và netmask
    - Dòng 2: khai báo những ip có thể cấp bằng dhcp
    - Dòng 3: khai báo địa chỉ broadcast
    - Dòng 4 : khai báo thời gian mặc định(1h) cấp cho client ip đó
    - Dòng 5: khai báo thời gian tối đa (2h) client được cấp ip đó

    ![Alt](/thuctap/anh/Screenshot_625.png)
- Tiến hành lưu file và chạy dịch vụ `dhcp`
  ```
  systemctl start dhcpd
  systemctl enable dhcpd
  ```
### Cài dặt nhận ip từ dhcp cho centos 7
- Do mặc định centos7 không cần phải cài dhcp-client mà ta chỉ cần vào cấu hình lại file `ifcfg-ens33` để nhận dhcp
  ```
  vi /etc/sysconfig/network-scripts/ifcfg-ens33
  ``` 
  - Thay đổi `BOOTPROTO` sang `dhcp` và xóa hết cấu hình liên quan đến ip tĩnh. Các bạn có thể tham khảo hình bên dưới
  ![Alt](/thuctap/anh/Screenshot_626.png)
- Lưu lại và tiến hành restart lại `NetworkManager`
  ```
  systemctl restart NetworkManager
  ```
- Kiểm tra ip bằng câu lệnh `ip a`
  ![Alt](/thuctap/anh/Screenshot_627.png)